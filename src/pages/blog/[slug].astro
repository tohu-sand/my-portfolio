---
import { getCollection, type CollectionEntry, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

type PostEntry = CollectionEntry<"posts">;

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post: PostEntry) => ({
    params: { slug: post.id.replace(/\.md$/, '') },
    props: { entry: post },
  }));
}
export const prerender = true;

const { entry } = Astro.props as { entry: PostEntry };
const { Content } = await render(entry);
const { data } = entry;
---
<BaseLayout title={data.title}>
  <article class="prose dark:prose-invert mx-auto">
    <h1>{data.title}</h1>
    <p class="text-sm text-stone-600 dark:text-stone-400">
      {data.date.toLocaleDateString("ja-JP")}
    </p>

    <img
      src={data.thumbnail}
      alt={data.title}
      class="w-full rounded-lg my-4"
      loading="lazy"
    />

    {data.excerpt && <p class="italic">{data.excerpt}</p>}

    <Content />
  </article>
</BaseLayout>
