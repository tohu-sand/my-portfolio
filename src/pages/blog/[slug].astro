---
import { getCollection, getEntryBySlug } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

/* 動的ルート用 */
export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((p) => ({ params: { slug: p.slug } }));
}

/* 記事取得 */
const { slug } = Astro.params;
const entry = await getEntryBySlug("posts", slug);
if (!entry) throw new Error("Post not found");

const { data } = entry;
const { Content } = await entry.render();   /* ★ ここがポイント */
---
<BaseLayout title={data.title}>
  <article class="prose mx-auto">
    <h1>{data.title}</h1>
    <p class="text-sm text-stone-600">
      {data.date.toLocaleDateString("ja-JP")}
    </p>

    <img
      src={data.thumbnail}
      alt={data.title}
      class="w-full rounded-lg my-4"
      loading="lazy"
    />

    {data.excerpt && <p class="italic">{data.excerpt}</p>}

    <Content />   <!-- Markdown 本文 -->
  </article>
</BaseLayout>
