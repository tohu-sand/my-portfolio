---
import { getCollection, getEntryBySlug, type CollectionEntry } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((p: CollectionEntry<"posts">) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("posts", slug);
if (!entry) throw new Error("Post not found");

const { data } = entry;
const { Content } = await entry.render();
---
<BaseLayout title={data.title}>
  <article class="prose dark:prose-invert mx-auto">
    <h1>{data.title}</h1>
    <p class="text-sm text-stone-600 dark:text-stone-400">
      {data.date.toLocaleDateString("ja-JP")}
    </p>

    <img
      src={data.thumbnail}
      alt={data.title}
      class="w-full rounded-lg my-4"
      loading="lazy"
    />

    {data.excerpt && <p class="italic">{data.excerpt}</p>}

    <Content />
  </article>
</BaseLayout>
