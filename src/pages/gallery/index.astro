---
import BaseLayout from "../../layouts/BaseLayout.astro";
import GalleryGrid from "../../components/GalleryGrid.astro";
import { getCollection } from "astro:content";

const artworks = await getCollection("gallery");

// ページ説明文
const pageDescription = "豆腐さんどのイラスト・漫画ギャラリーページです。オリジナル作品を公開しています。";

const galleryImages = artworks.filter((artwork) => {
  const kind = artwork.data.kind ?? "illustration";
  return kind === "illustration";
});

// 構造化データの準備
const galleryStructuredData = {
  "@context": "https://schema.org",
  "@type": "ImageGallery",
  "name": "ギャラリー - 豆腐さんど",
  "description": pageDescription,
  "url": "https://tohu-sand.com/gallery/",
  "author": {
    "@type": "Person",
    "name": "豆腐さんど",
    "url": "https://tohu-sand.com/"
  },
  "image": galleryImages.map((artwork) => ({
    "@type": "ImageObject",
    "name": artwork.data.title,
    "url": artwork.data.image || artwork.data.thumbnail,
    "thumbnailUrl": artwork.data.thumbnail,
    "dateCreated": artwork.data.date.toISOString().split('T')[0],
    "creditText": "豆腐さんど",
    "copyrightNotice": `© ${artwork.data.date.getFullYear()} 豆腐さんど`,
    "license": "https://tohu-sand.com/",
    "acquireLicensePage": "https://tohu-sand.com/contact/",
    "creator": {
      "@type": "Person",
      "name": "豆腐さんど",
      "url": "https://tohu-sand.com/"
    },
    "description": artwork.data.description || artwork.data.title,
    "contentUrl": `https://tohu-sand.com/gallery/${artwork.slug}/`
  }))
};
---

<BaseLayout 
  title="ギャラリー - 豆腐さんど"
  description={pageDescription}
  ogTitle="ギャラリー - 豆腐さんど"
  ogDescription={pageDescription}
  ogUrl="https://tohu-sand.com/gallery/"
>
  <script type="application/ld+json" set:html={JSON.stringify(galleryStructuredData)}></script>
  
  <h2 class="text-2xl font-bold mb-6 text-stone-900 dark:text-stone-100">Gallery</h2>
  <GalleryGrid />
</BaseLayout>
