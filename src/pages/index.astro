---
import { getCollection } from "astro:content";
import InfoCard from "../components/InfoCard.astro";
import PostCard from "../components/PostCard.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import type { CollectionEntry } from "astro:content";
import { compareByDateDesc } from "../utils/date";

const infos = await getCollection("info", ({ data }: CollectionEntry<"info">) =>
  data.date >= new Date(new Date().setDate(new Date().getDate() - 30))
);

const posts = await getCollection("posts", () => true);
const latestPost = posts.slice().sort(compareByDateDesc)[0];

type InfoEntry = typeof infos[0];
---

<BaseLayout title="豆腐さんどのホームページ">
  <div class="flex justify-center mb-8">
    <img
      src="https://cdn.tohu-sand.com/illust/2025-08-31_medium.png"
      alt="トップ画像"
      class="w-full max-w-md rounded-lg shadow-lg object-cover"
      loading="eager"
    />
  </div>

  <h2 class="text-2xl font-bold mb-4 text-stone-900 dark:text-stone-100">About</h2>
  <p class="text-stone-700 dark:text-stone-300 mb-6 ">
    <strong>豆腐さんど(@tohu_sand)</strong><br />
    趣味でイラスト・漫画を描いています。コミティアにて同人サークル「ロボット技術研究会」を主宰しています。
  </p>

  <h2 class="text-2xl font-bold mt-10 mb-4 text-stone-900 dark:text-stone-100">Upcoming Info</h2>
  <div class="space-y-4">
    {infos.length
      ? infos.map((e: InfoEntry) => <InfoCard entry={e} />)
      : <p class="text-stone-600 dark:text-stone-400">現在お知らせはありません。</p>}
  </div>

  <h2 class="text-2xl font-bold mt-10 mb-4 text-stone-900 dark:text-stone-100">Recent Post</h2>
  {latestPost
    ? <PostCard entry={latestPost} />
    : <p class="text-stone-600 dark:text-stone-400">まだブログ記事がありません。</p>}
</BaseLayout>