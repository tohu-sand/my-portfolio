---
import { Icon } from 'astro-icon/components';
---

<button
  id="dark-mode-toggle"
  class="p-2 rounded-lg bg-stone-200 dark:bg-stone-700 hover:bg-stone-300 dark:hover:bg-stone-600 transition-colors"
  aria-label="ダークモードの切り替え"
>
  <Icon name="lucide:sun" id="sun-icon" class="w-5 h-5 text-stone-900 dark:text-stone-100" />
  <Icon name="lucide:moon" id="moon-icon" class="w-5 h-5 text-stone-900 dark:text-stone-100 hidden" />
</button>

<style>
  #sun-icon {
    display: block;
  }
  #moon-icon {
    display: none;
  }
  
  :global(.dark) #sun-icon {
    display: none;
  }
  :global(.dark) #moon-icon {
    display: block;
  }
</style>

<script>
  function initDarkMode() {
    const toggle = document.getElementById('dark-mode-toggle');
    const html = document.documentElement;
    
    const currentTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    if (currentTheme === 'dark' || (!currentTheme && prefersDark)) {
      html.classList.add('dark');
    } else {
      html.classList.remove('dark');
    }
    
    toggle?.addEventListener('click', () => {
      html.classList.toggle('dark');
      const isDark = html.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDarkMode);
  } else {
    initDarkMode();
  }
  
  document.addEventListener('astro:page-load', initDarkMode);
</script>
