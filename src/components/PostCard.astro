---
import type { CollectionEntry } from "astro:content";
import { entryToSlug } from "../utils/slug";
import { formatDateJP } from "../utils/date";

interface Props {
  entry: CollectionEntry<"posts"> | CollectionEntry<"gallery">;
}

const { entry } = Astro.props;
const { data } = entry;
const resolvedSlug = entryToSlug(entry);
const dateStr = formatDateJP(data.date);

// コレクションの種類を判定
const isGallery = entry.collection === "gallery";
const typeLabel = isGallery ? "ギャラリー" : "ブログ";
const baseUrl = isGallery ? "/gallery/" : "/blog/";
---
<article class="group h-full rounded-xl border border-stone-200 dark:border-stone-700 overflow-hidden bg-white dark:bg-stone-800 shadow transition-shadow hover:shadow-lg dark:shadow-stone-900/50 dark:hover:shadow-stone-900/70">
  <a href={`${baseUrl}${resolvedSlug}/`} class="flex h-full flex-col">
    <div class="relative h-40 overflow-hidden">
      <img
        src={data.thumbnail}
        alt={data.title}
        class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
        loading="lazy"
      />
      <span class="absolute inset-0 bg-black/30 opacity-0 transition-opacity duration-300 group-hover:opacity-100" aria-hidden="true"></span>
    </div>
    <div class="flex flex-1 flex-col p-4">
      <h3 class="text-lg font-semibold line-clamp-2 text-stone-900 dark:text-stone-100">{data.title}</h3>
      <p class="mt-1 text-sm text-stone-600 dark:text-stone-400">
        {dateStr}{isGallery ? ` · ${typeLabel}` : ""}
      </p>
      {"excerpt" in data && data.excerpt && <p class="mt-2 text-sm line-clamp-2 text-stone-700 dark:text-stone-300">{data.excerpt}</p>}
    </div>
  </a>
</article>
